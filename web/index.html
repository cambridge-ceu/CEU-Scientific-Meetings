<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        
        
        
        <link rel="shortcut icon" href="../img/favicon.ico">
        <title>Website - CEU scientific meetings</title>
        <link href="../css/bootstrap.min.css" rel="stylesheet">
        <link href="../css/font-awesome.min.css" rel="stylesheet">
        <link href="../css/base.css" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github.min.css">
        <link href="../stylesheets/extra.css" rel="stylesheet">
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/Bash.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/HTML.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/Java.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/JavaScript.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/Perl.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/Python.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/R.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/rust.min.js"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/languages/yaml.min.js"></script>
        <script>hljs.highlightAll();</script> 
    </head>

    <body>
        <div class="navbar fixed-top navbar-expand-lg navbar-dark bg-dark">
            <div class="container">
                <a class="navbar-brand" href="..">CEU scientific meetings</a>
                <!-- Expander button -->
                <button type="button" class="navbar-toggler" data-toggle="collapse" data-target="#navbar-collapse">
                    <span class="navbar-toggler-icon"></span>
                </button>

                <!-- Expanded navigation -->
                <div id="navbar-collapse" class="navbar-collapse collapse">
                        <!-- Main navigation -->
                        <ul class="nav navbar-nav">
                            <li class="navitem">
                                <a href=".." class="nav-link"></a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Chronicle <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../2024/" class="dropdown-item">2024</a>
</li>
                                    
<li>
    <a href="../2023/" class="dropdown-item">2023</a>
</li>
                                    
<li>
    <a href="../2022/" class="dropdown-item">2022</a>
</li>
                                    
<li>
    <a href="../2021/" class="dropdown-item">2021</a>
</li>
                                    
<li>
    <a href="../2020/" class="dropdown-item">2020</a>
</li>
                                    
<li>
    <a href="../mhs/" class="dropdown-item">Mental health support</a>
</li>
                                    
<li>
    <a href="../COVID-19/" class="dropdown-item">The COVID-19 pandemic</a>
</li>
                                    
<li>
    <a href="../Cambridge-Baker-Joint-Symposium/" class="dropdown-item">The Cambridge/Baker Joint Symposium</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../HDR-UK/" class="nav-link">HDR(UK)</a>
                            </li>
                            <li class="navitem">
                                <a href="../schedules/" class="nav-link">Schedules</a>
                            </li>
                            <li class="dropdown">
                                <a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown">Resources <b class="caret"></b></a>
                                <ul class="dropdown-menu">
                                    
<li>
    <a href="../CEU/" class="dropdown-item">CEU</a>
</li>
                                    
<li>
    <a href="../DPHPC/" class="dropdown-item">DPHPC</a>
</li>
                                    
<li>
    <a href="../School/" class="dropdown-item">School</a>
</li>
                                    
<li>
    <a href="../University/" class="dropdown-item">University</a>
</li>
                                </ul>
                            </li>
                            <li class="navitem">
                                <a href="../channels/" class="nav-link">Channels</a>
                            </li>
                            <li class="navitem">
                                <a href="../talks/" class="nav-link">Talks</a>
                            </li>
                        </ul>

                    <ul class="nav navbar-nav ml-auto">
                        <li class="nav-item">
                            <a href="#" class="nav-link" data-toggle="modal" data-target="#mkdocs_search_modal">
                                <i class="fa fa-search"></i> Search
                            </a>
                        </li>
                    </ul>
                </div>
            </div>
        </div>

        <div class="container">
            <div class="row">
                    <div class="col-md-3"><div class="navbar-light navbar-expand-md bs-sidebar hidden-print affix" role="complementary">
    <div class="navbar-header">
        <button type="button" class="navbar-toggler collapsed" data-toggle="collapse" data-target="#toc-collapse" title="Table of Contents">
            <span class="fa fa-angle-down"></span>
        </button>
    </div>

    
    <div id="toc-collapse" class="navbar-collapse collapse card bg-secondary">
        <ul class="nav flex-column">
            
            <li class="nav-item" data-level="1"><a href="#website" class="nav-link">Website</a>
              <ul class="nav flex-column">
            <li class="nav-item" data-level="2"><a href="#htaccess" class="nav-link">.htaccess</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#socket" class="nav-link">Socket</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#raven-authentication" class="nav-link">Raven authentication</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#sample" class="nav-link">Sample</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#webserversrcfnet" class="nav-link">webserver.srcf.net</a>
              <ul class="nav flex-column">
              </ul>
            </li>
            <li class="nav-item" data-level="2"><a href="#additional-information" class="nav-link">Additional information</a>
              <ul class="nav flex-column">
              </ul>
            </li>
              </ul>
            </li>
        </ul>
    </div>
</div></div>
                    <div class="col-md-9" role="main">

<h1 id="website">Website</h1>
<blockquote>
<p>The SRCF uses Apache to serve websites so if you need to run a backend web app, for example a Django, Rails or Express server, then you will need to forward web requests, e.g., CRSid.user.srcf.net through to an app running on a localhost port.</p>
</blockquote>
<ul>
<li>Technical reference, <a href="https://docs.srcf.net/reference/">https://docs.srcf.net/reference/</a></li>
<li>Tutorial, <a href="https://docs.srcf.net/tutorials/">https://docs.srcf.net/tutorials/</a></li>
</ul>
<h2 id="htaccess">.htaccess</h2>
<p>It sits on the current directory.</p>
<pre><code>RequestHeader set Host expr=%{HTTP_HOST}
RequestHeader set X-Forwarded-For expr=%{REMOTE_ADDR}
RequestHeader set X-Forwarded-Proto expr=%{REQUEST_SCHEME}
RequestHeader set X-Real-IP expr=%{REMOTE_ADDR}
RewriteRule ^(.*)$ unix:&lt;path-to-socket&gt;|http://&lt;url&gt;/$1 [P,NE,L,QSA]
</code></pre>
<p>e.g.,</p>
<ul>
<li>Unix<ul>
<li>RewriteRule "^(Caprion/.*)$" unix:/home/jhz22/web.sock|http://localhost/$1 [P,NE,L,QSA]</li>
<li>RewriteRule "^(Caprion/.*)$" unix:/home/jhz22/web.sock|http://jhz22.user.srcf.net/$1 [P,NE,L,QSA]</li>
</ul>
</li>
<li>TCP -- no headers<ul>
<li>RewriteRule "^(.*)$" http://localhost:8012/$1 [P,NE,L,QSA]</li>
</ul>
</li>
</ul>
<p>See also</p>
<ul>
<li>Check: <a href="http://www.htaccesscheck.com/">http://www.htaccesscheck.com/</a></li>
<li>Tester: <a href="https://htaccess.madewithlove.com/">https://htaccess.madewithlove.com/</a></li>
</ul>
<p>Based on chatGPT,</p>
<ul>
<li>RequestHeader set Host expr=%{HTTP_HOST}: Sets the Host header to the value of the HTTP_HOST variable.</li>
<li>RequestHeader set X-Forwarded-For expr=%{REMOTE_ADDR}: Sets the X-Forwarded-For header to the value of the REMOTE_ADDR variable.</li>
<li>RequestHeader set X-Forwarded-Proto expr=%{REQUEST_SCHEME}: Sets the X-Forwarded-Proto header to the value of the REQUEST_SCHEME variable.</li>
<li>RequestHeader set X-Real-IP expr=%{REMOTE_ADDR}: Sets the X-Real-IP header to the value of the REMOTE_ADDR variable.</li>
<li>RewriteRule ^(.*)$ unix:<path-to-socket>|http://&lt;url&gt;/$1 [P,NE,L,QSA]: The RewriteRule is rewriting the URL. It proxies requests to a specified URL with a Unix domain socket. Replace <path-to-socket> with the actual path to your Unix domain socket and <url> with the target URL.</li>
<li>[P,NE,L,QSA]: These are flags that modify the behavior of the RewriteRule:<ul>
<li>P: Proxy flag. This tells Apache to treat the substitution as a proxy request and forward it to the specified location.</li>
<li>NE: No Escape flag. This prevents Apache from escaping special characters in the substitution, useful when substituting URLs.</li>
<li>L: Last flag. This indicates that if the current rule matches, no further rules should be processed for this request.</li>
<li>QSA: Query String Append flag. This appends the original query string to the substituted URL.</li>
</ul>
</li>
</ul>
<p>Make sure to replace <path-to-socket> and <url> with your actual values. Additionally, ensure that the necessary modules (mod_headers and mod_rewrite) are enabled in your Apache configuration.</p>
<p>Logs are at <code>/var/log/apache2/user/$USER/</code>.</p>
<h2 id="socket">Socket</h2>
<h3 id="via-c">via C</h3>
<p>Source: <a href="https://gist.github.com/ryran/170009f84c11bf3243b1">https://gist.github.com/ryran/170009f84c11bf3243b1</a></p>
<pre><code class="language-c">#include &lt;fcntl.h&gt;
#include &lt;sys/un.h&gt;
#include &lt;sys/socket.h&gt;
#include &lt;sys/stat.h&gt;
#include &lt;sys/types.h&gt;
#include &lt;unistd.h&gt;

int main(int argc, char **argv)
{
    // The following line expects the socket path to be first argument
    char * mysocketpath = argv[1];
    // Alternatively, you could comment that and set it statically:
    //char * mysocketpath = &quot;/tmp/mysock&quot;;
    struct sockaddr_un namesock;
    int fd;
    namesock.sun_family = AF_UNIX;
    strncpy(namesock.sun_path, (char *)mysocketpath, sizeof(namesock.sun_path));
    fd = socket(AF_UNIX, SOCK_DGRAM, 0);
    bind(fd, (struct sockaddr *) &amp;namesock, sizeof(struct sockaddr_un));
    close(fd);
    return 0;
}
</code></pre>
<p>and compiled with <code>gcc cleate-a-socket.c -o create-a-socket; create-a-socket web.sock</code>.</p>
<h3 id="via-python">via Python</h3>
<p>Source: <a href="https://www.digitalocean.com/community/tutorials/python-socket-programming-server-client">https://www.digitalocean.com/community/tutorials/python-socket-programming-server-client</a></p>
<p>We employ <code>python server.py</code> and <code>python client.py</code> below for two interactive sessions which ends with <code>bye</code>.</p>
<h4 id="serverpy">server.py</h4>
<pre><code class="language-python">import socket

def server_program():
    # get the hostname
    host = socket.gethostname()
    port = 5000  # initiate port no above 1024

    server_socket = socket.socket()  # get instance
    # look closely. The bind() function takes tuple as argument
    server_socket.bind((host, port))  # bind host address and port together

    # configure how many client the server can listen simultaneously
    server_socket.listen(2)
    conn, address = server_socket.accept()  # accept new connection
    print(&quot;Connection from: &quot; + str(address))
    while True:
        # receive data stream. it won't accept data packet greater than 1024 bytes
        data = conn.recv(1024).decode()
        if not data:
            # if data is not received break
            break
        print(&quot;from connected user: &quot; + str(data))
        data = input(' -&gt; ')
        conn.send(data.encode())  # send data to the client

    conn.close()  # close the connection

if __name__ == '__main__':
    server_program()
</code></pre>
<h4 id="clientpy">client.py</h4>
<pre><code class="language-python">import socket

def client_program():
    host = socket.gethostname()  # as both code is running on same pc
    port = 5000  # socket server port number

    client_socket = socket.socket()  # instantiate
    client_socket.connect((host, port))  # connect to the server

    message = input(&quot; -&gt; &quot;)  # take input

    while message.lower().strip() != 'bye':
        client_socket.send(message.encode())  # send message
        data = client_socket.recv(1024).decode()  # receive response

        print('Received from server: ' + data)  # show in terminal

        message = input(&quot; -&gt; &quot;)  # again take input

    client_socket.close()  # close the connection

if __name__ == '__main__':
    client_program()
</code></pre>
<h2 id="raven-authentication">Raven authentication</h2>
<p>Web: <a href="https://docs.srcf.net/reference/web-hosting/raven-authentication/">https://docs.srcf.net/reference/web-hosting/raven-authentication/</a></p>
<h2 id="sample">Sample</h2>
<p><a href="https://sample.soc.srcf.net/flask/">https://sample.soc.srcf.net/flask/</a></p>
<p>based on <code>/public/societies/sample/flask/app.py</code>.</p>
<h3 id="template">Template</h3>
<p>Check <code>/public/societies/sample/run-python.sh</code>.</p>
<h3 id="unix-socket">Unix socket</h3>
<pre><code class="language-bash">#!/bin/bash -e

. ~/myapp/venv/bin/activate
exec gunicorn -w 2 -b unix:/home/jhz22/web.sock --log-file - app:app
</code></pre>
<p>The mode field of <code>web.sock</code> has flag <code>s</code>, see <a href="https://en.wikipedia.org/wiki/Unix_file_types">https://en.wikipedia.org/wiki/Unix_file_types</a>.</p>
<p>To access we use <code>curl</code></p>
<pre><code class="language-bash">curl --unix-socket /home/jhz22/web.sock http://localhost
</code></pre>
<p>or <code>python</code></p>
<pre><code class="language-python">import socket

sock = socket.socket(socket.AF_UNIX, socket.SOCK_STREAM)
sock.connect('/home/jhz22/web.sock')

# Now you can send and receive data through the socket

sock.close()
</code></pre>
<h2 id="webserversrcfnet">webserver.srcf.net</h2>
<p>(To be refined)</p>
<h3 id="uwsgi">uWSGI</h3>
<pre><code class="language-bash">uwsgi --socket /home/jhz22/web.sock --plugin python3 --enable-threads --wsgi-file app.py --callable app --processes 2 --master --chmod-socket=666
</code></pre>
<h3 id="nginx">nginx</h3>
<p>Web: <a href="https://nginx.org/">https://nginx.org/</a></p>
<h4 id="installation">Installation</h4>
<pre><code class="language-bash">cd /public/home/jhz22
wget -qO- https://nginx.org/download/nginx-1.24.0.tar.gz | \
tar xfz -
cd nginx-1.24.0
./configure --prefix=/public/home/jhz22
make
make install
/public/home/jhz22/sbin/nginx -t

</code></pre>
<h4 id="nginxconf">nginx.conf</h4>
<p>Replace the following section into <code>/public/home/jhz22/conf/nginx.conf</code></p>
<pre><code>server {
    listen 8000;
    server_name jhz22.user.srcf.net;

    location / {
        include uwsgi_params;
        uwsgi_pass unix:/home/jhz22/web.sock;
    }
}
</code></pre>
<p>showing that</p>
<pre><code>jhz22@sinkhole:/public/home/jhz22/sbin/nginx -t
nginx: the configuration file /public/home/jhz22/conf/nginx.conf syntax is ok
nginx: configuration file /public/home/jhz22/conf/nginx.conf test is successful
</code></pre>
<h4 id="nginxservice">nginx.service</h4>
<p>Location: ~/.config/systemd/user</p>
<pre><code>Description=Nginx HTTP server

[Service]
ExecStart=/public/home/jhz22/sbin/nginx
Restart=always

[Install]
WantedBy=default.target
</code></pre>
<h4 id="systemctl">systemctl</h4>
<p>Instances of use</p>
<pre><code class="language-bash">systemctl --user daemon-reload
systemctl --user list-unit-files
systemctl --user restart nginx
systemctl --user status nginx
systemctl --user reset-failed nginx
systemctl --user stop nginx
</code></pre>
<p>The first line is necessary since we would get a message,</p>
<pre><code>Warning: The unit file, source configuration file or drop-ins of nginx.service changed on disk. Run 'systemctl --user daemon-reload' to reload units.
</code></pre>
<h2 id="additional-information">Additional information</h2>
<ul>
<li>Apache Benchmark tool, <code>ab -n 1000 -c 5 -C "somecookie=rawr" http://ourwebsite.com/</code></li>
<li>Caddy, <a href="https://caddyserver.com/">https://caddyserver.com/</a>, <code>caddy run --config webserver-configs/Caddyfile</code></li>
<li>Grav, <a href="https://getgrav.org/">https://getgrav.org/</a> (<a href="https://github.com/caddyserver/caddy">GitHub</a>, <a href="https://caddyserver.com/api/download?os=linux&amp;arch=arm64&amp;idempotency=33011962771737">Linux arm64</a>)</li>
<li>wrk, <a href="https://github.com/wg/wrk">https://github.com/wg/wrk</a></li>
<li>ws, <a href="https://github.com/websockets/ws">https://github.com/websockets/ws</a></li>
</ul></div>
            </div>
        </div>

        <footer class="col-md-12">
            <hr>
            <p>Documentation built with <a href="https://www.mkdocs.org/">MkDocs</a>.</p>
        </footer>
        <script src="../js/jquery-3.6.0.min.js"></script>
        <script src="../js/bootstrap.min.js"></script>
        <script>
            var base_url = "..",
                shortcuts = {"help": 191, "next": 78, "previous": 80, "search": 83};
        </script>
        <script src="../js/base.js"></script>
        <script src="../javascripts/config.js"></script>
        <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
        <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
        <script src="../search/main.js"></script>

        <div class="modal" id="mkdocs_search_modal" tabindex="-1" role="dialog" aria-labelledby="searchModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="searchModalLabel">Search</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
                <p>From here you can search these documents. Enter your search terms below.</p>
                <form>
                    <div class="form-group">
                        <input type="search" class="form-control" placeholder="Search..." id="mkdocs-search-query" title="Type search term here">
                    </div>
                </form>
                <div id="mkdocs-search-results" data-no-results-text="No results found"></div>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div><div class="modal" id="mkdocs_keyboard_modal" tabindex="-1" role="dialog" aria-labelledby="keyboardModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title" id="keyboardModalLabel">Keyboard Shortcuts</h4>
                <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
            </div>
            <div class="modal-body">
              <table class="table">
                <thead>
                  <tr>
                    <th style="width: 20%;">Keys</th>
                    <th>Action</th>
                  </tr>
                </thead>
                <tbody>
                  <tr>
                    <td class="help shortcut"><kbd>?</kbd></td>
                    <td>Open this help</td>
                  </tr>
                  <tr>
                    <td class="next shortcut"><kbd>n</kbd></td>
                    <td>Next page</td>
                  </tr>
                  <tr>
                    <td class="prev shortcut"><kbd>p</kbd></td>
                    <td>Previous page</td>
                  </tr>
                  <tr>
                    <td class="search shortcut"><kbd>s</kbd></td>
                    <td>Search</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="modal-footer">
            </div>
        </div>
    </div>
</div>

    </body>
</html>
